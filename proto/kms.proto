syntax = "proto3";
package kms;

service KmsEndpoint {
  rpc Decrypt(DecryptionRequest) returns (DecryptionResponse);
  rpc Reencrypt(ReencryptionRequest) returns (ReencryptionResponse);
}

enum FheType {
  Bool = 0;
  Euint8 = 1;
  Euint16 = 2;
  Euint32 = 3;
}

message Proof {
  uint32 height = 1;
  bytes merkle_patricia_proof = 2;
}

message DecryptionRequestPayload {
  bytes verification_key = 1;
  FheType fhe_type = 2;
  bytes ciphertext = 3;
  Proof proof = 4;
  bytes randomness = 5;
}

message DecryptionRequest {
  bytes signature = 1;
  DecryptionRequestPayload payload = 2;
}

message DecryptionResponsePayload {
  uint32 shares_needed = 1;
  bytes verification_key = 2;
  bytes plaintext = 3;
  bytes digest = 4;
  bytes randomness = 5;
}

message DecryptionResponse {
  bytes signature = 1;
  DecryptionResponsePayload payload = 2;
}

message AggregatedDecryptionRespone {
  repeated DecryptionResponse responses = 1;
}

message ReencryptionRequestPayload {
  bytes verification_key = 1;
  bytes enc_key = 2;
  FheType fhe_type = 3;
  bytes ciphertext = 4;
  Proof proof = 5;
  bytes randomness = 6;
  }

message ReencryptionRequest {
  bytes signature = 1;
  ReencryptionRequestPayload payload = 2;
}

message ReencryptionResponse {
  uint32 shares_needed = 1;
  bytes verification_key = 2;
  FheType fhe_type = 3;
  bytes signcrypted_ciphertext = 4;
  bytes digest = 5;
}

message AggregatedReencryptionRespone {
  repeated ReencryptionResponse responses = 1;
}
