# Benchmarks
Below we report benchmark numbers that relate to the blockchain setting.
That is we consider 13 kms-core parties, with the `BC_PARAMS_SNS` TFHE parameters providing
128 bit computational security and 80 bits statistical security.
These are the parameters used in the fhevm deployment.

Benchmarks number for the complete distributed decryption (i.e. including the Switch and Squash)
and for a variety of parameters and number of parties are avaiable in the M4 NIST document[^1].

[^1]: https://github.com/zama-ai/NIST-Threshold

## Distributed Decryption

To benchmark distributed decryption, we send `num_requests` requests at once and
measure how long it takes to compute the result (`LATENCY`) averaged over all the parties.
We perform this test with a variety of TFHE-rs `euint` types and also report the throughput
for each with both the `type/s` metric (i.e. the number of requests divided by the latency).
We also the report the `LWE/s` metric that represents the throughput in number of *raw* LWE ciphertexts that are decrypted to be able to compare the different types.

### LAN
By LAN setting we mean all the parties are run from within the same EC2 region.

#### C5AX8LARGE (32vCPUs, 64GiB RAM)
| num_requests | Bool LATENCY (ms) | Bool THROUGHPUT (Bool/s) | Bool THROUGHPUT (LWE/s) | U16 LATENCY (ms) | U16 THROUGHPUT (U16/s) | U16 THROUGHPUT (LWE/s) | U64 LATENCY (ms) | U64 THROUGHPUT (U64/s) | U64 THROUGHPUT (LWE/s) | U128 LATENCY (ms) | U128 THROUGHPUT (U128/s) | U128 THROUGHPUT (LWE/s) |
| --------- | ------------------ | ------------------------- | ------------------------ | ----------------- | ----------------------- | ----------------------- | ----------------- | ----------------------- | ----------------------- | ------------------ | ------------------------- | ------------------------ |
| 1         | 2                  | 565                       | 565                      | 89                | 11                      | 90                      | 96                | 10                      | 333                     | 82                 | 12                        | 785                      |
| 2         | 84                 | 23                        | 23                       | 91                | 22                      | 176                     | 101               | 19                      | 636                     | 111                | 18                        | 1159                     |
| 4         | 43                 | 93                        | 93                       | 95                | 42                      | 338                     | 110               | 36                      | 1168                    | 119                | 33                        | 2162                     |
| 8         | 95                 | 84                        | 84                       | 101               | 79                      | 636                     | 125               | 64                      | 2059                    | 137                | 58                        | 3737                     |
| 16        | 115                | 139                       | 139                      | 113               | 142                     | 1141                    | 143               | 112                     | 3593                    | 175                | 91                        | 5872                     |
| 32        | 129                | 248                       | 248                      | 142               | 226                     | 1814                    | 189               | 169                     | 5417                    | 244                | 131                       | 8401                     |
| 64        | 178                | 359                       | 359                      | 207               | 310                     | 2480                    | 285               | 224                     | 7187                    | 401                | 159                       | 10230                    |
| 128       | 259                | 494                       | 494                      | 294               | 436                     | 3489                    | 470               | 272                     | 8720                    | 679                | 188                       | 12077                    |
| 256       | 427                | 599                       | 599                      | 514               | 498                     | 3985                    | 820               | 312                     | 9995                    | 1271               | 201                       | 12896                    |
| 512       | 748                | 685                       | 685                      | 929               | 551                     | 4409                    | 1539              | 332                     | 10649                   | 2401               | 213                       | 13651                    |
| 1024      | 1435               | 713                       | 713                      | 1702              | 601                     | 4815                    | 3078              | 332                     | 10649                   | 4682               | 218                       | 13999                    |
| 2048      | 2814               | 727                       | 727                      | 3410              | 600                     | 4805                    | 6267              | 326                     | 10458                   | 14552              | 140                       | 9007                     |


#### C5AX16LARGE (64vCPUs, 128GiB RAM)

| num_requests | Bool LATENCY (ms) | Bool THROUGHPUT (Bool/s) | Bool THROUGHPUT (LWE/s) | U16 LATENCY (ms) | U16 THROUGHPUT (U16/s) | U16 THROUGHPUT (LWE/s) | U64 LATENCY (ms) | U64 THROUGHPUT (U64/s) | U64 THROUGHPUT (LWE/s) | U128 LATENCY (ms) | U128 THROUGHPUT (U128/s) | U128 THROUGHPUT (LWE/s) |
| --------- | ------------------ | ------------------------- | ------------------------ | ----------------- | ----------------------- | ----------------------- | ----------------- | ----------------------- | ----------------------- | ------------------ | ------------------------- | ------------------------ |
| 1         | 5                  | 213                       | 213                      | 93                | 10                      | 86                      | 106               | 9                       | 304                     | 108                | 9                         | 593                      |
| 2         | 3                  | 666                       | 666                      | 90                | 22                      | 178                     | 100               | 20                      | 642                     | 112                | 17                        | 1143                     |
| 4         | 89                 | 44                        | 44                       | 97                | 41                      | 330                     | 106               | 37                      | 1212                    | 122                | 33                        | 2114                     |
| 8         | 87                 | 91                        | 91                       | 105               | 76                      | 610                     | 117               | 68                      | 2193                    | 152                | 52                        | 3375                     |
| 16        | 107                | 149                       | 149                      | 111               | 144                     | 1157                    | 142               | 112                     | 3605                    | 180                | 89                        | 5718                     |
| 32        | 124                | 258                       | 258                      | 143               | 223                     | 1790                    | 186               | 172                     | 5509                    | 244                | 131                       | 8422                     |
| 64        | 165                | 389                       | 389                      | 200               | 320                     | 2566                    | 280               | 229                     | 7334                    | 407                | 157                       | 10071                    |
| 128       | 250                | 512                       | 512                      | 305               | 419                     | 3357                    | 473               | 271                     | 8676                    | 697                | 183                       | 11758                    |
| 256       | 383                | 668                       | 668                      | 520               | 492                     | 3939                    | 838               | 305                     | 9782                    | 1258               | 203                       | 13030                    |
| 512       | 741                | 691                       | 691                      | 1003              | 510                     | 4085                    | 1536              | 333                     | 10673                   | 2336               | 219                       | 14031                    |
| 1024      | 1240               | 826                       | 826                      | 1680              | 609                     | 4878                    | 3046              | 336                     | 10760                   | 4594               | 222                       | 14266                    |
| 2048      | 2610               | 784                       | 784                      | 3571              | 573                     | 4588                    | 11709             | 174                     | 5597                    | 9301               | 220                       | 14092                    |

#### C7AX8LARGE (32vCPUs, 64GiB RAM)
| num_requests | Bool LATENCY (ms) | Bool THROUGHPUT (Bool/s) | Bool THROUGHPUT (LWE/s) | U16 LATENCY (ms) | U16 THROUGHPUT (U16/s) | U16 THROUGHPUT (LWE/s) | U64 LATENCY (ms) | U64 THROUGHPUT (U64/s) | U64 THROUGHPUT (LWE/s) | U128 LATENCY (ms) | U128 THROUGHPUT (U128/s) | U128 THROUGHPUT (LWE/s) |
| --------- | ------------------ | ------------------------- | ------------------------ | ----------------- | ----------------------- | ----------------------- | ----------------- | ----------------------- | ----------------------- | ------------------ | ------------------------- | ------------------------ |
| 1         | 47                 | 21                        | 21                       | 53                | 18                      | 151                     | 57                | 17                      | 567                     | 58                 | 17                        | 1106                     |
| 2         | 4                  | 530                       | 530                      | 55                | 36                      | 294                     | 59                | 34                      | 1100                    | 68                 | 29                        | 1890                     |
| 4         | 51                 | 78                        | 78                       | 56                | 71                      | 572                     | 66                | 60                      | 1950                    | 76                 | 52                        | 3389                     |
| 8         | 59                 | 136                       | 136                      | 62                | 130                     | 1040                    | 74                | 109                     | 3492                    | 91                 | 88                        | 5659                     |
| 16        | 68                 | 235                       | 235                      | 75                | 213                     | 1710                    | 93                | 172                     | 5514                    | 125                | 128                       | 8192                     |
| 32        | 92                 | 351                       | 351                      | 103               | 312                     | 2500                    | 136               | 235                     | 7533                    | 185                | 173                       | 11079                    |
| 64        | 132                | 488                       | 488                      | 167               | 383                     | 3067                    | 226               | 283                     | 9065                    | 330                | 194                       | 12446                    |
| 128       | 211                | 606                       | 606                      | 274               | 467                     | 3739                    | 385               | 332                     | 10647                   | 551                | 232                       | 14879                    |
| 256       | 419                | 611                       | 611                      | 478               | 535                     | 4287                    | 710               | 360                     | 11539                   | 1057               | 242                       | 15509                    |
| 512       | 731                | 700                       | 700                      | 904               | 566                     | 4534                    | 1370              | 373                     | 11965                   | 2057               | 248                       | 15932                    |
| 1024      | 1539               | 665                       | 665                      | 1728              | 592                     | 4740                    | 2645              | 387                     | 12392                   | 4619               | 221                       | 14190                    |
| 2048      | 2953               | 693                       | 693                      | 3652              | 560                     | 4486                    | 6792              | 301                     | 9648                    | 9873               | 207                       | 13275                    |


### WAN
By WAN setting we mean parties are distributed across the eu-west, eu-central, us-west, us-east EC2 regions.

#### C5AX8LARGE (32vCPUs, 64GiB RAM)

| num_requests | Bool LATENCY (ms) | Bool THROUGHPUT (Bool/s) | Bool THROUGHPUT (LWE/s) | U16 LATENCY (ms) | U16 THROUGHPUT (U16/s) | U16 THROUGHPUT (LWE/s) | U64 LATENCY (ms) | U64 THROUGHPUT (U64/s) | U64 THROUGHPUT (LWE/s) | U128 LATENCY (ms) | U128 THROUGHPUT (U128/s) | U128 THROUGHPUT (LWE/s) |
| --------- | ------------------ | ------------------------- | ------------------------ | ----------------- | ----------------------- | ----------------------- | ----------------- | ----------------------- | ----------------------- | ------------------ | ------------------------- | ------------------------ |
| 1         | 112                | 8                         | 8                        | 197               | 5                       | 40                      | 175               | 5                       | 183                     | 161                | 6                         | 398                      |
| 2         | 113                | 17                        | 17                       | 197               | 10                      | 81                      | 209               | 9                       | 307                     | 196                | 10                        | 654                      |
| 4         | 189                | 21                        | 21                       | 202               | 19                      | 158                     | 333               | 12                      | 384                     | 374                | 10                        | 685                      |
| 8         | 154                | 51                        | 51                       | 294               | 27                      | 217                     | 335               | 23                      | 764                     | 354                | 22                        | 1446                     |
| 16        | 291                | 54                        | 54                       | 331               | 48                      | 386                     | 391               | 40                      | 1309                    | 492                | 32                        | 2082                     |
| 32        | 332                | 96                        | 96                       | 365               | 87                      | 701                     | 500               | 64                      | 2049                    | 685                | 46                        | 2993                     |
| 64        | 377                | 170                       | 170                      | 519               | 123                     | 987                     | 702               | 91                      | 2921                    | 899                | 71                        | 4556                     |
| 128       | 560                | 228                       | 228                      | 711               | 180                     | 1440                    | 951               | 134                     | 4310                    | 1233               | 103                       | 6647                     |
| 256       | 671                | 381                       | 381                      | 875               | 292                     | 2342                    | 1361              | 188                     | 6022                    | 1818               | 140                       | 9014                     |
| 512       | 1027               | 498                       | 498                      | 1312              | 390                     | 3123                    | 1990              | 257                     | 8236                    | 2853               | 179                       | 11488                    |
| 1024      | 1640               | 624                       | 624                      | 2047              | 500                     | 4003                    | 3311              | 309                     | 9896                    | 5029               | 203                       | 13031                    |
| 2048      | 2922               | 700                       | 700                      | 3757              | 545                     | 4361                    | 6199              | 330                     | 10572                   | 9927               | 206                       | 13204                    |

#### C5AX16LARGE (64vCPUs, 128GiB RAM)
| num_requests | Bool LATENCY (ms) | Bool THROUGHPUT (Bool/s) | Bool THROUGHPUT (LWE/s) | U16 LATENCY (ms) | U16 THROUGHPUT (U16/s) | U16 THROUGHPUT (LWE/s) | U64 LATENCY (ms) | U64 THROUGHPUT (U64/s) | U64 THROUGHPUT (LWE/s) | U128 LATENCY (ms) | U128 THROUGHPUT (U128/s) | U128 THROUGHPUT (LWE/s) |
| --------- | ------------------ | ------------------------- | ------------------------ | ----------------- | ----------------------- | ----------------------- | ----------------- | ----------------------- | ----------------------- | ------------------ | ------------------------- | ------------------------ |
| 1         | 114                | 8                         | 8                        | 150               | 6                       | 53                      | 202               | 4                       | 158                     | 193                | 5                         | 332                      |
| 2         | 111                | 18                        | 18                       | 179               | 11                      | 89                      | 200               | 10                      | 320                     | 218                | 9                         | 587                      |
| 4         | 112                | 35                        | 35                       | 199               | 20                      | 161                     | 290               | 13                      | 442                     | 342                | 11                        | 749                      |
| 8         | 186                | 43                        | 43                       | 297               | 26                      | 215                     | 337               | 23                      | 761                     | 360                | 22                        | 1422                     |
| 16        | 244                | 65                        | 65                       | 330               | 48                      | 388                     | 385               | 41                      | 1330                    | 499                | 32                        | 2055                     |
| 32        | 341                | 94                        | 94                       | 350               | 91                      | 733                     | 517               | 61                      | 1980                    | 677                | 47                        | 3028                     |
| 64        | 372                | 172                       | 172                      | 515               | 124                     | 994                     | 704               | 90                      | 2911                    | 925                | 69                        | 4429                     |
| 128       | 549                | 233                       | 233                      | 711               | 180                     | 1440                    | 974               | 131                     | 4207                    | 1255               | 101                       | 6527                     |
| 256       | 669                | 382                       | 382                      | 912               | 280                     | 2245                    | 1372              | 186                     | 5971                    | 1780               | 143                       | 9206                     |
| 512       | 1027               | 498                       | 498                      | 1318              | 388                     | 3108                    | 2001              | 255                     | 8191                    | 2856               | 179                       | 11473                    |
| 1024      | 1618               | 632                       | 632                      | 2050              | 499                     | 3996                    | 3247              | 315                     | 10093                   | 4924               | 207                       | 13311                    |
| 2048      | 2849               | 718                       | 718                      | 3404              | 601                     | 4813                    | 8663              | 236                     | 7565                    | 9295               | 220                       | 14102                    |


#### C7AX8LARGE (32vCPUs, 64GiB RAM)
| num_requests | Bool LATENCY (ms) | Bool THROUGHPUT (Bool/s) | Bool THROUGHPUT (LWE/s) | U16 LATENCY (ms) | U16 THROUGHPUT (U16/s) | U16 THROUGHPUT (LWE/s) | U64 LATENCY (ms) | U64 THROUGHPUT (U64/s) | U64 THROUGHPUT (LWE/s) | U128 LATENCY (ms) | U128 THROUGHPUT (U128/s) | U128 THROUGHPUT (LWE/s) |
| --------- | ------------------ | ------------------------- | ------------------------ | ----------------- | ----------------------- | ----------------------- | ----------------- | ----------------------- | ----------------------- | ------------------ | ------------------------- | ------------------------ |
| 1         | 162                | 6                         | 6                        | 132               | 7                       | 60                      | 125               | 8                       | 256                     | 148                | 6                         | 434                      |
| 2         | 113                | 17                        | 17                       | 165               | 12                      | 97                      | 162               | 12                      | 397                     | 179                | 11                        | 715                      |
| 4         | 162                | 24                        | 24                       | 156               | 25                      | 206                     | 273               | 14                      | 470                     | 296                | 13                        | 867                      |
| 8         | 145                | 55                        | 55                       | 269               | 29                      | 238                     | 298               | 26                      | 859                     | 311                | 25                        | 1649                     |
| 16        | 264                | 60                        | 60                       | 296               | 54                      | 432                     | 354               | 45                      | 1450                    | 458                | 34                        | 2236                     |
| 32        | 306                | 104                       | 104                      | 317               | 101                     | 809                     | 458               | 69                      | 2238                    | 582                | 55                        | 3522                     |
| 64        | 332                | 192                       | 192                      | 467               | 137                     | 1097                    | 649               | 98                      | 3158                    | 835                | 76                        | 4909                     |
| 128       | 508                | 252                       | 252                      | 672               | 190                     | 1525                    | 867               | 147                     | 4726                    | 1132               | 113                       | 7242                     |
| 256       | 604                | 424                       | 424                      | 798               | 321                     | 2568                    | 1239              | 206                     | 6612                    | 1607               | 159                       | 10200                    |
| 512       | 907                | 565                       | 565                      | 1167              | 438                     | 3511                    | 1806              | 283                     | 9072                    | 2529               | 202                       | 12958                    |
| 1024      | 1490               | 687                       | 687                      | 1821              | 562                     | 4500                    | 2870              | 356                     | 11417                   | 4298               | 238                       | 15248                    |
| 2048      | 2853               | 718                       | 718                      | 3434              | 596                     | 4771                    | 5670              | 361                     | 11559                   | 9185               | 222                       | 14270                    |


## Key Generation
### Preprocessing

TODO when we have numbers

### Online

TODO when we have numbers
